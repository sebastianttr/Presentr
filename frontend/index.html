<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet" type="text/css">
    <link href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/ionicons@^4.0.0/dist/css/ionicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@^3.0.0/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@^3.5.2/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/quasar@^1.0.5/dist/quasar.min.css" rel="stylesheet" type="text/css">
    <link rel="icon" href="https://icons-for-free.com/iconfiles/png/512/quasar-1324440220466918651.png" type="image/x-icon">
    <title>IoT UseLessCases</title>
    <style type="text/css">
        .aiit_fach {
            color: blue;
        }
    </style>
    <title>IoT UseCases</title>
    <meta type="text/css">
    </meta>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/quasar@^1.0.5/dist/quasar.ie.polyfills.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@latest/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@^1.0.5/dist/quasar.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@^1.0.5/dist/lang/pt-br.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@^1.0.5/dist/icon-set/fontawesome-v5.umd.min.js"></script>
    <div id="q-app">
        <q-layout view="lhr lpr lfr">
            <q-page-container>
                <q-page>
                    <q-page-sticky style="z-index: 1;" position="top-right" :offset="[18, 18]">
                        <q-btn flat round color="black" icon="settings" @click="showDialog=true" />
                    </q-page-sticky>


                    <transition name="slide-fade">
                        <q-card v-if="showDialog==true" style="width:350px;
                            margin: 10px;
                            position:absolute;
                            right:0px; 
                            z-index: 1;
                            padding: 10px;">
                            <div class="row items-center justify-between">
                                <div class="text-weight" style="font-size: 20px;">Settings</div>
                                <q-btn round flat color="black" icon="cancel" @click="showDialog=false" />
                            </div>
                            <q-btn rounded style="width: 100%;margin-top: 10px;" color="green" label="Add new page" @click="addNewPage"></q-btn>
                            <q-btn rounded style="width: 100%;margin-top: 10px;" color="green" label="Generate new room" @click="generateNewRoom"></q-btn>

                            <q-scroll-area style="height: 200px;">
                                <div v-for="(item,index) in pages">
                                    <q-expansion-item expand-separator icon="perm_identity" label="Account settings" caption="John Doe">
                                        <q-card>
                                            <div class="row items-center">
                                                <div style="font-size: 15px;">
                                                    Mute
                                                </div>
                                                <q-toggle v-model="item.mute" color="green" />
                                            </div>
                                        </q-card>
                                    </q-expansion-item>
                                </div>
                            </q-scroll-area>
                        </q-card>
                    </transition>

                    <div class="prevPageDiv" @click="test1--">
                    </div>

                    <div class="nextPageDiv" @click="test1++">
                    </div>

                    <q-carousel :keep-alive="true" style="width: 100vw;height: 100vh;z-index: -1;" transition-prev="slide-right" transition-next="slide-left" swipeable animated v-model="test1" infinite>
                        <q-carousel-slide :name=0>
                            <video style="min-width: 100%;min-height: 100%;" autoplay id=local></video>
                        </q-carousel-slide>
                        <div v-for="(item,index) in pages">
                            <q-carousel-slide style="min-width: 100%;min-height: 100%;" :name="index" img-src="IMAGES/Bild1.jpg">
                                <video style="min-width: 100%;min-height: 100%;" autoplay :id="'local'+index"></video>
                            </q-carousel-slide>
                        </div>
                    </q-carousel>


                    <q-dialog v-model="start">
                        <div class="q-ma-md" style="border-radius: 20px;box-shadow: 2px 2px 15px rgba(0, 10, 12, 0.8);background-color: white;">
                            <div style="width:400px;">
                                <div class="column items-center justify-center content-center">
                                    <div class="text-h4 q-ma-sm">Welcome!</div>
                                    <div>Select the following:</div>
                                    <q-btn-toggle class="q-ma-md" v-model="roleSelection" push rounded outlined toggle-color="purple" :options="[
                                        {value: 'master', slot: 'one'},
                                        {value: 'slave', slot: 'two'},
                                        ]">
                                        <template v-slot:one>
                                        <div class="row items-center no-wrap">
                                            <div class="text-center">
                                             Master <br>
                                             I display video
                                            </div>
                                            <q-icon right name="computer" />
                                        </div>
                                        </template>

                                        <template v-slot:two>
                                        <div class="row items-center no-wrap">
                                            <div class="text-center">
                                            Slave <br>
                                            I stream video
                                            </div>
                                            <q-icon right name="view_in_ar" />
                                        </div>
                                        </template>


                                    </q-btn-toggle>
                                </div>
                            </div>
                        </div>
                    </q-dialog>

                </q-page>
            </q-page-container>
        </q-layout>
    </div>
    <script>
        var app = new Vue({
            el: '#q-app',
            data: {
                start: false,
                roleSelection: "master",
                webrtcConf: {
                    'iceServers': [{
                        'urls': 'stun:stun.l.google.com:19302'
                    }]
                },
                test1: 0,
                fullscreen: false,
                showDialog: false,
                localVideo: null,
                pages: [],
                webSocketAccept: null,
                websocketAdd: null
            },
            methods: {
                refreshMainCamera() {
                    var v = this
                    navigator.mediaDevices.getUserMedia({
                        audio: false,
                        video: {
                            width: {
                                min: 1280
                            },
                            height: {
                                min: 720
                            }
                        }
                    }, ).then(stream => {
                        v.localVideo.srcObject = stream;
                    })
                },
                refrshVideo() {
                    //pages.irgendwos
                },
                addNewPage() {
                    console.log("addNewPage");
                    this.pages.push({
                        mute: true,
                        localVideo: null
                    })
                },
                generateNewRoom() {
                    let pc = new RTCPeerConnection(conf);
                    pc.createOffer().then(des => {
                        console.log('createOffer ok ');
                        pc.setLocalDescription(des).then(() => {
                            setTimeout(function() {
                                if (pc.iceGatheringState == "complete") {
                                    return;
                                } else {
                                    console.log('after GetherTimeout');
                                    //localOffer.value = JSON.stringify(pc.localDescription);
                                }
                            }, 2000);
                            console.log('setLocalDescription ok');
                        }).catch(errHandler);
                        // For chat
                    }).catch(errHandler);
                }
            },
            watch: {
                test1(newValue, oldValue) {
                    newValue = newValue % (this.pages.length + 1);
                    if (newValue < 0) newValue = 0;
                    if (newValue == 0)
                        this.refreshMainCamera();
                    else
                        this.refrshVideo();
                    this.test1 = newValue
                },
                pages(newValue, oldValue) {}
            },
            beforeDestroy() {},
            mounted: function() {
                this.localVideo = document.getElementById("local");
                this.refreshMainCamera();
            }
        })
    </script>
    <style>
        .prevPageDiv {
            opacity: 0;
            background-color: grey;
            position: absolute;
            width: 100px;
            height: 100%;
            left: 0px;
            transition: 0.5s;
        }
        
        .prevPageDiv:hover {
            opacity: 0.8;
        }
        
        .nextPageDiv {
            opacity: 0;
            background-color: grey;
            position: absolute;
            width: 100px;
            height: 100%;
            right: 0px;
            transition: 0.5s;
        }
        
        .nextPageDiv:hover {
            opacity: 0.8;
        }
        
        .slide-fade-enter-active {
            transition: all .3s ease;
        }
        
        .slide-fade-leave-active {
            transition: all .3s cubic-bezier(1.0, 0.5, 0.8, 1.0);
        }
        
        .slide-fade-enter,
        .slide-fade-leave-to
        /* .slide-fade-leave-active below version 2.1.8 */
        
        {
            transform: translateX(10px);
            opacity: 0;
        }
    </style>
</body>

</html>